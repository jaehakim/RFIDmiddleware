<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>RFID ë¯¸ë“¤ì›¨ì–´ ê¸°ëŠ¥ ë‹¤ì´ì–´ê·¸ë¨</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<style>
  body {
    font-family: 'ë§‘ì€ ê³ ë”•', sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    color: #1B2A4A;
    margin-bottom: 8px;
  }
  h2 {
    color: #1B2A4A;
    border-bottom: 2px solid #1B2A4A;
    padding-bottom: 6px;
    margin-top: 40px;
  }
  .diagram-section {
    background: white;
    border-radius: 10px;
    padding: 24px;
    margin: 16px auto;
    max-width: 1200px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  .mermaid {
    display: flex;
    justify-content: center;
  }
</style>
</head>
<body>

<h1>RFID ë¯¸ë“¤ì›¨ì–´ - ê¸°ëŠ¥ ë‹¤ì´ì–´ê·¸ë¨</h1>

<!-- 1. ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì„± -->
<div class="diagram-section">
<h2>1. ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì„±</h2>
<div class="mermaid">
graph TB
    subgraph EXT["ì™¸ë¶€ ì‹œìŠ¤í…œ"]
        API_CLIENT["REST API í´ë¼ì´ì–¸íŠ¸<br/>(í¬íŠ¸ 18080)"]
        MARIADB[("MariaDB<br/>10.0.0.148:13306<br/>tagflow DB")]
        EXTERNAL["ì™¸ë¶€ ê´€ë¦¬ ì‹œìŠ¤í…œ<br/>(ìì‚°/ë°˜ì¶œí—ˆìš© ê´€ë¦¬)"]
    end

    subgraph MW["RFID ë¯¸ë“¤ì›¨ì–´"]
        MAIN["MainFrame<br/>(GUI ë©”ì¸ ìœˆë„ìš°)"]
        RM["ReaderManager<br/>(ë©€í‹° ë¦¬ë”ê¸° ê´€ë¦¬)"]
        API["ApiServer<br/>(REST API :18080)"]
        AR["AssetRepository<br/>(ìì‚°/ë°˜ì¶œ ìºì‹œ)"]
        TR["TagRepository<br/>(íƒœê·¸ ë°°ì¹˜ ì €ì¥)"]
        DM["DatabaseManager<br/>(DB ì—°ê²° ê´€ë¦¬)"]
        WLC["WarningLightController<br/>(ê²½ê´‘ë“±/ë¶€ì € ì œì–´)"]
    end

    subgraph READERS["RFID ë¦¬ë”ê¸°"]
        R1["Reader-01<br/>192.168.0.143"]
        R2["Reader-02..N"]
    end

    READERS -->|"TCP íƒœê·¸ ìˆ˜ì‹ "| RM
    RM --> MAIN
    MAIN --> WLC
    API_CLIENT -->|"HTTP"| API
    API --> RM
    API --> AR
    DM --> MARIADB
    TR --> DM
    AR --> DM
    EXTERNAL -->|"INSERT/UPDATE"| MARIADB

    style EXT fill:#e8ecf1,stroke:#1B2A4A
    style MW fill:#dbeafe,stroke:#1B2A4A
    style READERS fill:#fef3c7,stroke:#b45309
</div>
</div>

<!-- 2. íƒœê·¸ ê°ì§€ ì²˜ë¦¬ íë¦„ -->
<div class="diagram-section">
<h2>2. íƒœê·¸ ê°ì§€ ì‹œ ì²˜ë¦¬ íë¦„</h2>
<div class="mermaid">
flowchart TD
    START(["ë¦¬ë”ê¸°ì—ì„œ íƒœê·¸ ê°ì§€<br/>(TCP ìˆ˜ì‹  ìŠ¤ë ˆë“œ)"])
    MASK{"EPC Mask<br/>í•„í„° í†µê³¼?"}
    ASSET{"AssetRepository<br/>ìì‚°ì •ë³´ ì¡°íšŒ<br/>(ë©”ëª¨ë¦¬ ìºì‹œ O(1))"}
    IS_ASSET{"assets í…Œì´ë¸”ì—<br/>ë“±ë¡ëœ EPC?"}
    PERMIT{"export_permissions<br/>ë°˜ì¶œí—ˆìš© ì—¬ë¶€?"}

    DISPLAY["TagDataPanelì— í‘œì‹œ<br/>(ì‹œê°„, ë¦¬ë”ê¸°, EPC, RSSI,<br/>ìì‚°ë²ˆí˜¸, ìì‚°ëª…, ë¶€ì„œ)"]
    DEDUP{"Caffeine ìºì‹œ<br/>ì¤‘ë³µ ì²´í¬<br/>(TTL ë‚´ ë™ì¼ EPC?)"}

    DB_INSERT["tag_reads INSERT<br/>(BlockingQueue â†’ ë°°ì¹˜ ì²˜ë¦¬<br/>50ê±´/500ms)"]
    RECENT["ìµœê·¼ íƒœê·¸ ëª©ë¡ ì¶”ê°€"]

    ALERT_DEDUP{"shouldAlert<br/>30ì´ˆ ë‚´ ì¤‘ë³µ?"}
    LIGHT_CHECK{"ê²½ê´‘ë“± ì„¤ì •<br/>ì ìš©(1)?"}
    BUZZER_CHECK{"ë¶€ì € ì„¤ì •<br/>ì ìš©(1)?"}
    LIGHT_ON["ê²½ê´‘ë“± ON<br/>(ë¦´ë ˆì´1 ë¹¨ê°„ë“±)<br/>5ì´ˆ ìë™ ì†Œë“±"]
    BUZZER_ON["ë¶€ì € ON<br/>(ë¦´ë ˆì´2)<br/>5ì´ˆ ìë™ OFF"]
    ALERT_DB["export_alerts INSERT<br/>(ë‹¨ê±´ ì¦‰ì‹œ ì‹¤í–‰)"]
    LOG_ALERT["ë¡œê·¸ ê¸°ë¡<br/>UNAUTHORIZED EXPORT"]

    SKIP_LOG["MASK í•„í„° ë¡œê·¸"]
    NORMAL["ì¼ë°˜ íƒœê·¸ ì²˜ë¦¬<br/>(ìì‚° ì•„ë‹˜)"]
    PERMITTED["ì •ìƒ ë°˜ì¶œ<br/>(ì´ˆë¡ ë°°ê²½)"]

    START --> MASK
    MASK -->|"ë¶ˆì¼ì¹˜"| SKIP_LOG
    MASK -->|"í†µê³¼"| ASSET
    ASSET --> IS_ASSET
    IS_ASSET -->|"ì•„ë‹ˆì˜¤"| NORMAL
    IS_ASSET -->|"ì˜ˆ"| PERMIT
    PERMIT -->|"í—ˆìš©ë¨"| PERMITTED
    PERMIT -->|"ë¯¸í—ˆìš©"| ALERT_DEDUP

    NORMAL --> DISPLAY
    PERMITTED --> DISPLAY
    DISPLAY --> DEDUP
    DEDUP -->|"ìºì‹œ HIT<br/>(ì¤‘ë³µ)"| UPDATE_ONLY["íšŸìˆ˜ë§Œ ì—…ë°ì´íŠ¸"]
    DEDUP -->|"ìºì‹œ MISS<br/>(ì‹ ê·œ)"| DB_INSERT
    DB_INSERT --> RECENT

    ALERT_DEDUP -->|"ì¤‘ë³µ"| DISPLAY
    ALERT_DEDUP -->|"ì‹ ê·œ ì•Œë¦¼"| LIGHT_CHECK
    LIGHT_CHECK -->|"ì ìš©"| LIGHT_ON
    LIGHT_CHECK -->|"ë¯¸ì ìš©"| BUZZER_CHECK
    LIGHT_ON --> BUZZER_CHECK
    BUZZER_CHECK -->|"ì ìš©"| BUZZER_ON
    BUZZER_CHECK -->|"ë¯¸ì ìš©"| ALERT_DB
    BUZZER_ON --> ALERT_DB
    ALERT_DB --> LOG_ALERT
    LOG_ALERT --> DISPLAY

    style START fill:#0078FF,color:white
    style LIGHT_ON fill:#DC0000,color:white
    style BUZZER_ON fill:#1E96DC,color:white
    style ALERT_DB fill:#FF6B6B,color:white
    style LOG_ALERT fill:#FFB400,color:white
    style DB_INSERT fill:#2ECC71,color:white
    style PERMITTED fill:#E8F5E8,stroke:#006E00
    style NORMAL fill:#f0f0f0
    style SKIP_LOG fill:#ddd
</div>
</div>

<!-- 3. ë¦¬ë”ê¸° ìƒíƒœ ì¹´ë“œ ì¸ë””ì¼€ì´í„° -->
<div class="diagram-section">
<h2>3. ë¦¬ë”ê¸° ìƒíƒœ ì¹´ë“œ ì¸ë””ì¼€ì´í„°</h2>
<div class="mermaid">
graph LR
    subgraph STATUS["ìƒíƒœ ìƒ‰ìƒ (ì¢Œì¸¡ ë°” + ì›)"]
        S1["â¬œ ë¯¸ì—°ê²°<br/>(íšŒìƒ‰)"]
        S2["ğŸŸ¨ ì—°ê²° ì¤‘<br/>(ë…¸ë‘)"]
        S3["ğŸŸ© ì—°ê²°ë¨<br/>(ì´ˆë¡)"]
        S4["ğŸŸ¦ ì½ê¸° ì¤‘<br/>(íŒŒë‘, ì ë©¸)"]
        S5["ğŸŸ¥ ì˜¤ë¥˜<br/>(ë¹¨ê°•)"]
    end

    subgraph IND["ì¸ë””ì¼€ì´í„° 3ì¢… (ìš°ì¸¡)"]
        direction TB
        I1["ğŸŸ¢ ë¹„í”„ìŒ<br/>ë…¹ìƒ‰<br/>READINGì‹œ í™œì„±í™”"]
        I2["ğŸ”µ ë¶€ì €<br/>íŒŒë‘<br/>ë¦´ë ˆì´ ONì‹œ í™œì„±í™”"]
        I3["ğŸŸ  ê²½ê´‘ë“±<br/>ì£¼í™©<br/>ë¦´ë ˆì´ ONì‹œ í™œì„±í™”"]
    end

    subgraph SHAPE["ëª¨ì–‘ë³„ ìƒíƒœ"]
        SH1["â–¡ íšŒìƒ‰ í…Œë‘ë¦¬ ì‚¬ê°í˜•<br/>â†’ ë¯¸ì‚¬ìš© (config OFF)"]
        SH2["â— ì»¬ëŸ¬ ì›í˜•<br/>â†’ ì‚¬ìš© (config ON, ëŒ€ê¸°)"]
        SH3["â— ì»¬ëŸ¬ ì›í˜• ê¹œë°•ì„<br/>â†’ í™œì„±í™” (ì´ë²¤íŠ¸ ë°œìƒ)"]
    end

    style STATUS fill:#f8f9fa,stroke:#1B2A4A
    style IND fill:#f0f8ff,stroke:#1B2A4A
    style SHAPE fill:#fff8e1,stroke:#b45309
</div>
</div>

<!-- 4. ê²½ê´‘ë“±/ë¶€ì €/ë¹„í”„ìŒ ì œì–´ -->
<div class="diagram-section">
<h2>4. ê²½ê´‘ë“± / ë¶€ì € / ë¹„í”„ìŒ ì œì–´</h2>
<div class="mermaid">
flowchart LR
    subgraph BEEP["ë¹„í”„ìŒ (ë‚´ì¥)"]
        B_CFG["readers.cfg<br/>ë¹„í”„ìŒ=1/0"]
        B_SDK["SDK<br/>setBuzzerEnable()"]
        B_WHEN["ì—°ê²° ì§í›„ ì ìš©<br/>READING ì¤‘ ì†Œë¦¬"]
        B_CFG --> B_SDK --> B_WHEN
    end

    subgraph BUZZER["ë¶€ì € (ë¦´ë ˆì´2)"]
        BZ_CFG["readers.cfg<br/>ë¶€ì €=1/0"]
        BZ_RELAY["ë¦´ë ˆì´ 2ë²ˆ<br/>ON/OFF"]
        BZ_WHEN["ë¯¸í—ˆê°€ ë°˜ì¶œ ê°ì§€ ì‹œ<br/>5ì´ˆ ìë™ OFF"]
        BZ_CFG --> BZ_RELAY --> BZ_WHEN
    end

    subgraph LIGHT["ê²½ê´‘ë“± (ë¦´ë ˆì´1)"]
        L_CFG["readers.cfg<br/>ê²½ê´‘ë“±=1/0"]
        L_RELAY["ë¦´ë ˆì´ 1ë²ˆ<br/>ë¹¨ê°„ë“± ON/OFF"]
        L_WHEN["ë¯¸í—ˆê°€ ë°˜ì¶œ ê°ì§€ ì‹œ<br/>5ì´ˆ ìë™ ì†Œë“±"]
        L_CFG --> L_RELAY --> L_WHEN
    end

    TRIGGER(["ë¯¸í—ˆê°€ ë°˜ì¶œ ê°ì§€"])
    TRIGGER --> BUZZER
    TRIGGER --> LIGHT

    READING(["ì¸ë²¤í† ë¦¬ ì‹œì‘<br/>(READING)"])
    READING --> BEEP

    style BEEP fill:#e8f5e8,stroke:#2ECC71
    style BUZZER fill:#e0f0ff,stroke:#1E96DC
    style LIGHT fill:#fff3e0,stroke:#FFB400
    style TRIGGER fill:#DC0000,color:white
    style READING fill:#0078FF,color:white
</div>
</div>

<!-- 5. DB ë°ì´í„° íë¦„ -->
<div class="diagram-section">
<h2>5. DB í…Œì´ë¸”ë³„ ë°ì´í„° íë¦„</h2>
<div class="mermaid">
flowchart TB
    subgraph TABLES["MariaDB - tagflow"]
        T1[("assets<br/>ìì‚° ë§ˆìŠ¤í„°")]
        T2[("export_permissions<br/>ë°˜ì¶œí—ˆìš© ëª©ë¡")]
        T3[("export_alerts<br/>ë°˜ì¶œì•Œë¦¼ ì´ë ¥")]
        T4[("tag_reads<br/>íƒœê·¸ ì½ê¸° ì´ë ¥")]
    end

    EXT_SYS["ì™¸ë¶€ ì‹œìŠ¤í…œ + API"]
    MW_WRITE["ë¯¸ë“¤ì›¨ì–´ (INSERT)"]
    CACHE["ë©”ëª¨ë¦¬ ìºì‹œ<br/>(30ì´ˆ ì£¼ê¸° ê°±ì‹ )"]

    EXT_SYS -->|"INSERT/UPDATE"| T1
    EXT_SYS -->|"INSERT/UPDATE/DELETE"| T2
    T1 -->|"SELECT *"| CACHE
    T2 -->|"SELECT (ìœ íš¨ê¸°ê°„)"| CACHE

    MW_WRITE -->|"ë¯¸í—ˆê°€ ë°˜ì¶œ ê°ì§€"| T3
    MW_WRITE -->|"íƒœê·¸ ê°ì§€ (ë°°ì¹˜)"| T4

    CACHE -->|"ìì‚°ì •ë³´ ì¡°íšŒ<br/>O(1) HashMap"| TAG_CHECK["íƒœê·¸ ê°ì§€ ì‹œ<br/>ìì‚°/ë°˜ì¶œ íŒë‹¨"]
    TAG_CHECK -->|"ë¯¸í—ˆê°€ ë°˜ì¶œ"| MW_WRITE

    style TABLES fill:#f0f0f0,stroke:#1B2A4A
    style EXT_SYS fill:#e8ecf1,stroke:#1B2A4A
    style MW_WRITE fill:#ffebee,stroke:#DC0000
    style CACHE fill:#e8f5e8,stroke:#2ECC71
    style TAG_CHECK fill:#dbeafe,stroke:#0078FF
</div>
</div>

<!-- 6. ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… -->
<div class="diagram-section">
<h2>6. ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œ ë° ì£¼ê¸°ì  ì‘ì—…</h2>
<div class="mermaid">
flowchart LR
    subgraph BG["ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…"]
        direction TB
        ASSET_REFRESH["AssetRepository<br/>30ì´ˆ ì£¼ê¸° ê°±ì‹ <br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>assets â†’ HashMap ìºì‹œ<br/>permissions â†’ Set ìºì‹œ"]
        TAG_WRITER["TagDB-Writer ìŠ¤ë ˆë“œ<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>BlockingQueue í´ë§<br/>50ê±´ or 500msë§ˆë‹¤<br/>executeBatch()"]
        WL_TIMER["WarningLight íƒ€ì´ë¨¸<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>ê²½ê´‘ë“±: 5ì´ˆ í›„ OFF<br/>ë¶€ì €: 5ì´ˆ í›„ OFF<br/>ì¬ê°ì§€ ì‹œ ë¦¬ì…‹"]
    end

    subgraph TCP["TCP ìˆ˜ì‹  ìŠ¤ë ˆë“œ (ë¦¬ë”ê¸°ë³„)"]
        TCP1["Reader-01 ìˆ˜ì‹ "]
        TCP2["Reader-02 ìˆ˜ì‹ "]
        TCPN["Reader-N ìˆ˜ì‹ "]
    end

    TCP -->|"íƒœê·¸ ë°ì´í„°"| EDT["Swing EDT<br/>(UI ê°±ì‹ )"]
    EDT -->|"offer()"| TAG_WRITER

    style BG fill:#f8f9fa,stroke:#1B2A4A
    style TCP fill:#fff8e1,stroke:#b45309
    style EDT fill:#dbeafe,stroke:#0078FF
</div>
</div>

<script>
mermaid.initialize({
    startOnLoad: true,
    theme: 'base',
    themeVariables: {
        primaryColor: '#dbeafe',
        primaryTextColor: '#1B2A4A',
        primaryBorderColor: '#1B2A4A',
        lineColor: '#4A5568',
        fontSize: '13px'
    },
    flowchart: {
        useMaxWidth: true,
        htmlLabels: true,
        curve: 'basis'
    }
});
</script>

</body>
</html>
